<?xml version='1.0'?>
<config
    xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
    xsi:noNamespaceSchemaLocation='urn:magento:module:Magento_Store:etc/config.xsd'
>
    <default>
		<df_payment>
			<all_pay>
				<!--
					2016-08-22
					Значением этой опции по умолчанию и так является true:
					@see \Df\Payment\Settings::requireBillingAddress()
					Однако здесь это значение всё равно нужно указать,
					чтобы галка была установлена для чекбокса.
				-->
				<requireBillingAddress>1</requireBillingAddress>
				<countries>TW</countries>
				<country_restriction>whitelist</country_restriction>
<!-- 2016-09-06
Платёжная система AllPay допускает транзакции только в TWD,
поэтому мы не делаем опцию выбора валюты в system.xml.
-->
				<currency>TWD</currency>
				<description>{store.name}</description>
				<descriptionOnKiosk>{store.name}</descriptionOnKiosk>
<!-- 
2016-08-29
2016-07-02
«Merchant trade number».
Varchar(20)
«Merchant trade number could not be repeated.
It is composed with upper and lower cases of English letter and numbers.»
Must be filled.
*
2016-07-05
Значение может содержать только цифры и латинские буквы.
Все другие символы недопустимы.
В принципе, стандартные номера заказов удовлетворяют этим условиям,
но вот нестандартные, вида ORD-2016/07-00274
(которые делает наш модуль Sales Documents Numberation) — не удовлетворяют.
Поэтому надо перекодировать проблемные символы.
*
Второй мыслью было использовать df_encryptor()->encrypt($this->o()->getIncrementId())
Однако хэш md5 имеет длину 32 символа: http://stackoverflow.com/questions/6317276
А хэш sha256 — 64 символа: http://stackoverflow.com/questions/3064133
allPay же ограничивает длину идентификатора 20 символами.
*
Поэтому используем иное решение: нестандартный идентификатор транзакции.
*
2016-07-17
Клиент просит, чтобы в качестве идентификатора платежа
всё-таки использовался номер заказа:
https://code.dmitry-fedyuk.com/m2e/allpay/issues/7
В принципе, это разумно: ведь нестандартные номера заказов
(которые, например, делает наш модуль Sales Documents Numberation)
будут использовать лишь немногие клиенты,
большинство же будет использовать стандартные номера заказов,
поэтому разумно предоставить этому большинству возможность
использовать в качестве идентификатора платежа номер заказа.
*
2017-01-05
Локальный внутренний идентификатор транзакции.
Мы намеренно передаваём этот идентификатор локальным (без приставки с именем модуля)
для удобства работы с этими идентификаторами в интерфейсе платёжной системы:
ведь там все идентификаторы имели бы одинаковую приставку.
-->				
				<identification>increment_id</identification>
				<log>1</log>
				<messageFailure><![CDATA[Sorry, the payment attempt is failed.
<br/>The payment service's message is «<b>{originalMessage}</b>».
<br/>Please try again, or try another payment method.]]></messageFailure>
				<optionsLocation>magento</optionsLocation>
				<testHashIV>v77hoKGq4kWxNNIS</testHashIV>
				<!--
					2016-06-29
					Note that we encrypt the live keys, but do not encrypt the test keys.
				-->
				<testHashKey>5294y06JbISpM5x9</testHashKey>
				<testMerchantID>2000132</testMerchantID>
				<title>歐付寶 allPay</title>
				<title_backend>歐付寶 allPay</title_backend>
				<waitPeriodATM>3</waitPeriodATM>
				<waitPeriodType>calendar_days</waitPeriodType>
			</all_pay>
		</df_payment>
        <payment>
            <dfe_all_pay>
				<model>Dfe\AllPay\Method</model>
            </dfe_all_pay>
        </payment>
    </default>
</config>
